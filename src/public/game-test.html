<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì¹˜í‚¨ìŠ¤í†¡ê²Œì„ API í…ŒìŠ¤íŠ¸</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(45deg, #ff6b6b, #feca57);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        
        .user-status {
            background: rgba(255,255,255,0.2);
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
        }
        
        .status-item {
            background: rgba(255,255,255,0.1);
            padding: 10px;
            border-radius: 8px;
            text-align: center;
        }
        
        .status-item strong {
            display: block;
            margin-bottom: 5px;
        }
        
        .logged-in {
            color: #51cf66;
        }
        
        .logged-out {
            color: #ff6b6b;
        }
        
        .tabs {
            display: flex;
            background: #f8f9fa;
            border-bottom: 1px solid #e9ecef;
        }
        
        .tab {
            flex: 1;
            padding: 15px 20px;
            background: #e9ecef;
            border: none;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: background-color 0.3s;
        }
        
        .tab.active {
            background: white;
            border-bottom: 3px solid #667eea;
        }
        
        .tab:hover {
            background: #dee2e6;
        }
        
        .tab.active:hover {
            background: white;
        }
        
        .tab-content {
            display: none;
            padding: 30px;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .form-section {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .form-section h3 {
            color: #495057;
            margin-bottom: 15px;
            border-bottom: 2px solid #667eea;
            padding-bottom: 5px;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #495057;
        }
        
        input, select, textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s;
        }
        
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .btn {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            transition: transform 0.3s, box-shadow 0.3s;
            margin: 5px;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        
        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .btn-danger {
            background: linear-gradient(45deg, #ff6b6b, #ee5a52);
        }
        
        .btn-success {
            background: linear-gradient(45deg, #51cf66, #40c057);
        }
        
        .btn-warning {
            background: linear-gradient(45deg, #ffd93d, #ff9500);
        }
        
        .game-list {
            display: grid;
            gap: 15px;
            margin-top: 20px;
        }
        
        .game-card {
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            padding: 20px;
            cursor: pointer;
            transition: border-color 0.3s, box-shadow 0.3s;
        }
        
        .game-card:hover {
            border-color: #667eea;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .game-card.selected {
            border-color: #667eea;
            background: #f0f4ff;
        }
        
        .game-detail {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 15px 0;
        }
        
        .info-item {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }
        
        .info-item strong {
            display: block;
            color: #495057;
            margin-bottom: 5px;
        }
        
        .status {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
            text-transform: uppercase;
        }
        
        .status.waiting {
            background: #ffeaa7;
            color: #d63031;
        }
        
        .status.playing {
            background: #00b894;
            color: white;
        }
        
        .stocks-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        
        .stock-card {
            background: white;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 15px;
            transition: box-shadow 0.3s;
        }
        
        .stock-card:hover {
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .price-change {
            font-weight: bold;
        }
        
        .price-change.positive {
            color: #00b894;
        }
        
        .price-change.negative {
            color: #e17055;
        }
        
        .players-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        
        .player-card {
            background: white;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 15px;
        }
        
        .player-card.current-user {
            border-color: #667eea;
            background: #f0f4ff;
        }
        
        .trade-section {
            background: #e8f5e8;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
        }
        
        .trade-form {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            align-items: end;
        }
        
        .response {
            background: #2d3748;
            color: #e2e8f0;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            font-family: 'Courier New', monospace;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
            border-left: 4px solid #667eea;
        }
        
        .error {
            background: #ff6b6b;
            color: white;
            padding: 10px;
            border-radius: 8px;
            margin: 10px 0;
        }
        
        .success {
            background: #51cf66;
            color: white;
            padding: 10px;
            border-radius: 8px;
            margin: 10px 0;
        }
        
        .warning {
            background: #ffd93d;
            color: #333;
            padding: 10px;
            border-radius: 8px;
            margin: 10px 0;
        }
        
        .hidden {
            display: none;
        }
        
        .loading {
            text-align: center;
            padding: 20px;
            color: #6c757d;
        }
        
        .token-display {
            font-family: monospace;
            font-size: 11px;
            word-break: break-all;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ” ì¹˜í‚¨ìŠ¤í†¡ê²Œì„ API í…ŒìŠ¤íŠ¸</h1>
            <p>ì‹¤ì‹œê°„ ì£¼ì‹ ê±°ë˜ ì‹œë®¬ë ˆì´ì…˜ ê²Œì„</p>
            
            <div class="user-status">
                <div class="status-item">
                    <strong>ë¡œê·¸ì¸ ìƒíƒœ</strong>
                    <span id="loginStatus" class="logged-out">ë¡œê·¸ì•„ì›ƒ</span>
                </div>
                <div class="status-item">
                    <strong>ì‚¬ìš©ì ì´ë©”ì¼</strong>
                    <span id="userEmail">-</span>
                </div>
                <div class="status-item">
                    <strong>í˜„ì¬ í”Œë ˆì´ì–´ ID</strong>
                    <span id="currentPlayerId">-</span>
                </div>
                <div class="status-item">
                    <strong>ì„ íƒëœ ê²Œì„</strong>
                    <span id="selectedGameId">-</span>
                </div>
                <div class="status-item">
                    <strong>JWT í† í°</strong>
                    <div class="token-display" id="tokenDisplay">-</div>
                </div>
            </div>
        </div>
        
        <div class="tabs">
            <button class="tab active" onclick="showTab('auth')">ë¡œê·¸ì¸ & ê²Œì„ ìƒì„±</button>
            <button class="tab" onclick="showTab('game')">ë‚´ ê²Œì„ ê´€ë¦¬</button>
        </div>
        
        <!-- ì²«ë²ˆì§¸ íƒ­: ë¡œê·¸ì¸ & ê²Œì„ ìƒì„± -->
        <div id="auth-tab" class="tab-content active">
            <div class="form-section">
                <h3>ğŸ” ì¸ì¦</h3>
                
                <!-- ìˆ˜ë™ í† í° ì…ë ¥ -->
                <div class="form-group">
                    <label>ìˆ˜ë™ JWT í† í° ì…ë ¥</label>
                    <input type="text" id="manualToken" placeholder="JWT í† í°ì„ ì§ì ‘ ì…ë ¥í•˜ì„¸ìš”">
                    <button class="btn btn-warning" onclick="setManualToken()">í† í° ì„¤ì •</button>
                </div>
                
                <!-- íšŒì›ê°€ì… -->
                <div class="form-group">
                    <label>íšŒì›ê°€ì…</label>
                    <input type="email" id="registerEmail" placeholder="ì´ë©”ì¼">
                    <input type="password" id="registerPassword" placeholder="ë¹„ë°€ë²ˆí˜¸">
                    <input type="text" id="registerNickname" placeholder="ë‹‰ë„¤ì„">
                    <button class="btn" onclick="register()">íšŒì›ê°€ì…</button>
                </div>
                
                <!-- ë¡œê·¸ì¸ -->
                <div class="form-group">
                    <label>ë¡œê·¸ì¸</label>
                    <input type="email" id="loginEmail" placeholder="ì´ë©”ì¼">
                    <input type="password" id="loginPassword" placeholder="ë¹„ë°€ë²ˆí˜¸">
                    <button class="btn" onclick="login()">ë¡œê·¸ì¸</button>
                    <button class="btn btn-danger" onclick="logout()">ë¡œê·¸ì•„ì›ƒ</button>
                </div>
            </div>
            
            <div class="form-section">
                <h3>ğŸ® ê²Œì„ ê´€ë¦¬</h3>
                
                <!-- ê²Œì„ ìƒì„± -->
                <div class="form-group">
                    <label>ê²Œì„ ìƒì„±</label>
                    <input type="text" id="gameTitle" placeholder="ê²Œì„ ì œëª©">
                    <button class="btn" onclick="createGame()" id="createGameBtn">ê²Œì„ ìƒì„±</button>
                </div>
                
                <!-- ê²Œì„ ì°¸ê°€ -->
                <div class="form-group">
                    <label>ê²Œì„ ì°¸ê°€</label>
                    <input type="text" id="joinGameId" placeholder="ê²Œì„ ID">
                    <input type="text" id="joinNickname" placeholder="ê²Œì„ ë‹‰ë„¤ì„">
                    <button class="btn" onclick="joinGame()" id="joinGameBtn">ê²Œì„ ì°¸ê°€</button>
                </div>
                
                <button class="btn btn-success" onclick="loadAllGames()">ëª¨ë“  ê²Œì„ ëª©ë¡ ë³´ê¸°</button>
            </div>
            
            <!-- API ì‘ë‹µ -->
            <div class="form-section">
                <h3>ğŸ“„ API ì‘ë‹µ</h3>
                <div id="apiResponse" class="response">API í…ŒìŠ¤íŠ¸ ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.</div>
            </div>
        </div>
        
        <!-- ë‘ë²ˆì§¸ íƒ­: ë‚´ ê²Œì„ ê´€ë¦¬ -->
        <div id="game-tab" class="tab-content">
            <div class="form-section">
                <h3>ğŸ¯ ë‚´ê°€ ì°¸ê°€í•œ ê²Œì„ ëª©ë¡</h3>
                <button class="btn btn-success" onclick="loadMyGames()">ë‚´ ê²Œì„ ëª©ë¡ ìƒˆë¡œê³ ì¹¨</button>
                <div id="myGamesList" class="game-list">
                    <div class="loading">ë¡œê·¸ì¸ í›„ ê²Œì„ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ì„¸ìš”.</div>
                </div>
            </div>
            
            <!-- ì„ íƒëœ ê²Œì„ ìƒì„¸ ì •ë³´ -->
            <div id="gameDetailSection">
                <div class="form-section">
                    <h3>ğŸ® ê²Œì„ ìƒì„¸ ì •ë³´</h3>
                    <div id="gameDetail" class="game-detail"></div>
                    <!-- í˜¸ìŠ¤íŠ¸ ì „ìš© ì»¨íŠ¸ë¡¤ -->
                    <div id="hostControls" class="hidden" style="margin-top: 20px;">
                        <h4>ğŸ¯ í˜¸ìŠ¤íŠ¸ ì „ìš© ì»¨íŠ¸ë¡¤</h4>
                        <div style="background: #e8f5e8; padding: 15px; border-radius: 8px;">
                            <button class="btn btn-success" onclick="startGame()" id="startGameBtn">ê²Œì„ ì‹œì‘</button>
                            <button class="btn btn-warning" onclick="pauseGame()" id="pauseGameBtn">ê²Œì„ ì¼ì‹œì •ì§€</button>
                            <button class="btn btn-danger" onclick="endGame()" id="endGameBtn">ê²Œì„ ì¢…ë£Œ</button>
                        </div>
                    </div>
                </div>
                
                <div class="form-section">
                    <h3>ğŸ“Š ë‚´ í”Œë ˆì´ì–´ ì •ë³´</h3>
                    <div id="myPlayerInfo" class="info-grid"></div>
                </div>
                
                <div class="form-section">
                    <h3>ğŸ“ˆ ì£¼ì‹ ì¢…ëª© ëª©ë¡</h3>
                    <div id="stocksList" class="stocks-grid"></div>
                </div>
                
                <div class="form-section">
                    <h3>ğŸ‘¥ ë‹¤ë¥¸ í”Œë ˆì´ì–´ë“¤</h3>
                    <div id="otherPlayersList" class="players-grid"></div>
                </div>
                
                <!-- ì£¼ì‹ ê±°ë˜ -->
                <div class="form-section trade-section">
                    <h3>ğŸ’° ì£¼ì‹ ê±°ë˜</h3>
                    <div class="trade-form">
                        <div class="form-group">
                            <label>ì¢…ëª© ì½”ë“œ</label>
                            <input type="text" id="tradeStockCode" placeholder="ì¢…ëª© ì½”ë“œ">
                        </div>
                        <div class="form-group">
                            <label>ê±°ë˜ ìœ í˜•</label>
                            <select id="tradeType">
                                <option value="BUY">ë§¤ìˆ˜</option>
                                <option value="SELL">ë§¤ë„</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>ìˆ˜ëŸ‰</label>
                            <input type="number" id="tradeQuantity" placeholder="ìˆ˜ëŸ‰" min="1">
                        </div>
                        <div class="form-group">
                            <label>&nbsp;</label>
                            <button class="btn" onclick="executeTrade()" id="executeTradeBtn">ê±°ë˜ ì‹¤í–‰</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:3000/api';
        let currentToken = localStorage.getItem('token');
        let currentUser = null;
        let selectedGame = null;
        let currentPlayer = null;

        // ì´ˆê¸°í™”
        window.onload = function() {
            updateUserStatus();
            if (currentToken) {
                verify();
            }
        };

        // íƒ­ ì „í™˜
        function showTab(tabName) {
            // ëª¨ë“  íƒ­ê³¼ íƒ­ ì»¨í…ì¸  ë¹„í™œì„±í™”
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            // ì„ íƒëœ íƒ­ê³¼ ì»¨í…ì¸  í™œì„±í™”
            event.target.classList.add('active');
            document.getElementById(tabName + '-tab').classList.add('active');
            
            // ê²Œì„ íƒ­ìœ¼ë¡œ ì „í™˜ì‹œ ë‚´ ê²Œì„ ëª©ë¡ ìë™ ë¡œë“œ
            if (tabName === 'game' && currentToken) {
                loadMyGames();
            }
        }

        // ì‚¬ìš©ì ìƒíƒœ ì—…ë°ì´íŠ¸
        function updateUserStatus() {
            document.getElementById('loginStatus').textContent = currentToken && currentUser ? 'ë¡œê·¸ì¸ë¨' : 'ë¡œê·¸ì•„ì›ƒ';
            document.getElementById('loginStatus').className = currentToken && currentUser ? 'logged-in' : 'logged-out';
            document.getElementById('userEmail').textContent = currentUser ? currentUser.email : '-';
            document.getElementById('currentPlayerId').textContent = currentPlayer ? currentPlayer.id : '-';
            document.getElementById('selectedGameId').textContent = selectedGame ? selectedGame.id : '-';
            document.getElementById('tokenDisplay').textContent = currentToken ? currentToken.substring(0, 30) + '...' : '-';
            
            // ì¸ì¦ì´ í•„ìš”í•œ ë²„íŠ¼ë“¤ ìƒíƒœ ì—…ë°ì´íŠ¸
            const authButtons = ['createGameBtn', 'joinGameBtn', 'executeTradeBtn'];
            authButtons.forEach(id => {
                const btn = document.getElementById(id);
                if (btn) {
                    btn.disabled = !currentToken;
                }
            });
        }

        // ì¸ì¦ì´ í•„ìš”í•œ ì‘ì—… ì „ ì²´í¬
        function checkAuth() {
            if (!currentToken) {
                showError('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');
                return false;
            }
            return true;
        }

        // ìˆ˜ë™ í† í° ì„¤ì •
        function setManualToken() {
            const token = document.getElementById('manualToken').value.trim();
            if (!token) {
                showError('í† í°ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            currentToken = token;
            localStorage.setItem('token', token);
            document.getElementById('manualToken').value = '';
            verify();
        }

        // ì¸ì¦ í•¨ìˆ˜ë“¤
        async function register() {
            const email = document.getElementById('registerEmail').value;
            const password = document.getElementById('registerPassword').value;
            const nickname = document.getElementById('registerNickname').value;
            
            if (!email || !password || !nickname) {
                showError('ëª¨ë“  í•„ë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/auth/register`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email, password, nickname })
                });

                const data = await response.json();
                showResponse('íšŒì›ê°€ì…', data);
                
                if (data.success && data.data) {
                    currentToken = data.data.token;
                    currentUser = data.data.user;
                    localStorage.setItem('token', currentToken);
                    updateUserStatus();
                    showSuccess('íšŒì›ê°€ì… ë° ìë™ ë¡œê·¸ì¸ ì„±ê³µ!');
                    
                    // ì…ë ¥ í•„ë“œ ì´ˆê¸°í™”
                    document.getElementById('registerEmail').value = '';
                    document.getElementById('registerPassword').value = '';
                    document.getElementById('registerNickname').value = '';
                }
            } catch (error) {
                showError('íšŒì›ê°€ì… ìš”ì²­ ì‹¤íŒ¨: ' + error.message);
            }
        }

        async function login() {
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            
            if (!email || !password) {
                showError('ì´ë©”ì¼ê³¼ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/auth/login`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email, password })
                });

                const data = await response.json();
                showResponse('ë¡œê·¸ì¸', data);
                
                if (data.success && data.data) {
                    currentToken = data.data.token;
                    currentUser = data.data.user;
                    localStorage.setItem('token', currentToken);
                    updateUserStatus();
                    showSuccess('ë¡œê·¸ì¸ ì„±ê³µ!');
                    
                    // ì…ë ¥ í•„ë“œ ì´ˆê¸°í™”
                    document.getElementById('loginEmail').value = '';
                    document.getElementById('loginPassword').value = '';
                }
            } catch (error) {
                showError('ë¡œê·¸ì¸ ìš”ì²­ ì‹¤íŒ¨: ' + error.message);
            }
        }

        async function verify() {
            if (!currentToken) return;

            try {
                const response = await fetch(`${API_BASE}/auth/verify`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ token: currentToken })
                });

                const data = await response.json();
                
                if (data.success && data.data) {
                    currentUser = data.data.user;
                    updateUserStatus();
                    showSuccess('í† í° ì¸ì¦ ì„±ê³µ!');
                } else {
                    showError('í† í°ì´ ìœ íš¨í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');
                    logout();
                }
            } catch (error) {
                showError('í† í° ê²€ì¦ ì‹¤íŒ¨: ' + error.message);
                logout();
            }
        }

        function logout() {
            currentToken = null;
            currentUser = null;
            selectedGame = null;
            currentPlayer = null;
            localStorage.removeItem('token');
            updateUserStatus();
            
            // ê²Œì„ ê´€ë ¨ UI ì´ˆê¸°í™”
            document.getElementById('gameDetailSection').classList.add('hidden');
            document.getElementById('myGamesList').innerHTML = '<div class="loading">ë¡œê·¸ì¸ í›„ ê²Œì„ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ì„¸ìš”.</div>';
            
            showSuccess('ë¡œê·¸ì•„ì›ƒ ë˜ì—ˆìŠµë‹ˆë‹¤.');
        }

        // ê²Œì„ ê´€ë¦¬ í•¨ìˆ˜ë“¤
        async function createGame() {
            if (!checkAuth()) return;
            
            const title = document.getElementById('gameTitle').value;
            if (!title) {
                showError('ê²Œì„ ì œëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/games`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${currentToken}`
                    },
                    body: JSON.stringify({ title })
                });

                const data = await response.json();
                showResponse('ê²Œì„ ìƒì„±', data);
                
                if (data.success) {
                    showSuccess('ê²Œì„ì´ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤!');
                    document.getElementById('gameTitle').value = '';
                }
            } catch (error) {
                showError('ê²Œì„ ìƒì„± ìš”ì²­ ì‹¤íŒ¨: ' + error.message);
            }
        }

        async function joinGame() {
            if (!checkAuth()) return;
            
            const gameId = document.getElementById('joinGameId').value;
            const nickname = document.getElementById('joinNickname').value;
            
            if (!gameId || !nickname) {
                showError('ê²Œì„ IDì™€ ë‹‰ë„¤ì„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/games/${gameId}/join`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${currentToken}`
                    },
                    body: JSON.stringify({ nickname })
                });

                const data = await response.json();
                showResponse('ê²Œì„ ì°¸ê°€', data);
                
                if (data.success) {
                    showSuccess('ê²Œì„ì— ì°¸ê°€í–ˆìŠµë‹ˆë‹¤!');
                    document.getElementById('joinGameId').value = '';
                    document.getElementById('joinNickname').value = '';
                }
            } catch (error) {
                showError('ê²Œì„ ì°¸ê°€ ìš”ì²­ ì‹¤íŒ¨: ' + error.message);
            }
        }

        async function loadAllGames() {
            try {
                const response = await fetch(`${API_BASE}/games`);
                const data = await response.json();
                showResponse('ì „ì²´ ê²Œì„ ëª©ë¡ ì¡°íšŒ', data);
            } catch (error) {
                showError('ê²Œì„ ëª©ë¡ ìš”ì²­ ì‹¤íŒ¨: ' + error.message);
            }
        }

        // ë‚´ ê²Œì„ ëª©ë¡ ë¡œë“œ
        async function loadMyGames() {
            if (!checkAuth()) return;

            try {
                // ì‚¬ìš©ìê°€ ì°¸ê°€í•œ ê²Œì„ ëª©ë¡ì„ ê°€ì ¸ì˜¤ëŠ” API í˜¸ì¶œ
                // ì‹¤ì œ API ì—”ë“œí¬ì¸íŠ¸ì— ë§ê²Œ ìˆ˜ì • í•„ìš”
                const response = await fetch(`${API_BASE}/users/games`, {
                    headers: { 'Authorization': `Bearer ${currentToken}` }
                });

                const data = await response.json();
                
                if (data.success && data.data) {
                    displayMyGames(data.data);
                } else {
                    // ëŒ€ì•ˆ: ì „ì²´ ê²Œì„ ëª©ë¡ì—ì„œ ë‚´ê°€ ì°¸ê°€í•œ ê²Œì„ í•„í„°ë§
                    await loadGamesAlternative();
                }
            } catch (error) {
                showError('ë‚´ ê²Œì„ ëª©ë¡ ìš”ì²­ ì‹¤íŒ¨: ' + error.message);
                // ëŒ€ì•ˆ ë°©ë²• ì‹œë„
                await loadGamesAlternative();
            }
        }

        // ëŒ€ì•ˆ ë°©ë²•: ì „ì²´ ê²Œì„ì—ì„œ í•„í„°ë§
        async function loadGamesAlternative() {
            try {
                const response = await fetch(`${API_BASE}/games`);
                const data = await response.json();
                
                if (data.success) {
                    // ì„ì‹œë¡œ ëª¨ë“  ê²Œì„ì„ í‘œì‹œ (ì‹¤ì œë¡œëŠ” ë‚´ê°€ ì°¸ê°€í•œ ê²Œì„ë§Œ í•„í„°ë§í•´ì•¼ í•¨)
                    displayMyGames(data.data);
                }
            } catch (error) {
                showError('ê²Œì„ ëª©ë¡ ìš”ì²­ ì‹¤íŒ¨: ' + error.message);
            }
        }

        function displayMyGames(games) {
            const container = document.getElementById('myGamesList');
            container.innerHTML = '';
            
            if (!games || games.length === 0) {
                container.innerHTML = '<div class="loading">ì°¸ê°€í•œ ê²Œì„ì´ ì—†ìŠµë‹ˆë‹¤.</div>';
                return;
            }

            games.forEach(game => {
                const gameCard = document.createElement('div');
                gameCard.className = 'game-card';
                gameCard.onclick = () => selectGame(game);
                
                gameCard.innerHTML = `
                    <h4>${game.title}</h4>
                    <p><strong>ê²Œì„ ID:</strong> ${game.id}</p>
                    <p><strong>ìƒíƒœ:</strong> <span class="status ${game.status.toLowerCase()}">${game.status}</span></p>
                    <p><strong>ì°¸ê°€ì:</strong> ${game.currentPlayers || 0}/${game.maxPlayers || 'N/A'}ëª…</p>
                    <p><strong>ë¼ìš´ë“œ:</strong> ${game.currentRound || 0}/${game.totalRounds || 'N/A'}</p>
                `;
                
                container.appendChild(gameCard);
            });
        }

        // ê²Œì„ ì„ íƒ
        async function selectGame(game) {
            selectedGame = game;
            updateUserStatus();
            
            // ì„ íƒëœ ê²Œì„ ì¹´ë“œ í•˜ì´ë¼ì´íŠ¸
            document.querySelectorAll('.game-card').forEach(card => card.classList.remove('selected'));
            event.target.classList.add('selected');
            
            // ê²Œì„ ìƒì„¸ ì •ë³´ ë¡œë“œ
            await loadGameDetails(game.id);
            
            document.getElementById('gameDetailSection').classList.remove('hidden');
        }

        // ê²Œì„ ìƒì„¸ ì •ë³´ ë¡œë“œ
        async function loadGameDetails(gameId) {
            try {
                // ê²Œì„ ì •ë³´
                const gameResponse = await fetch(`${API_BASE}/games/${gameId}`);
                const gameData = await gameResponse.json();
                
                // ì°¸ê°€ì ëª©ë¡
                const playersResponse = await fetch(`${API_BASE}/games/${gameId}/players`);
                const playersData = await playersResponse.json();
                
                // ì¢…ëª© ëª©ë¡
                const stocksResponse = await fetch(`${API_BASE}/games/${gameId}/stocks`);
                const stocksData = await stocksResponse.json();
                
                if (gameData.success) {
                    displayGameDetails(gameData.data);
                    
                    if (playersData.success) {
                        displayPlayers(playersData.data);
                    }
                    
                    if (stocksData.success) {
                        displayStocks(stocksData.data);
                    }
                }
                
            } catch (error) {
                showError('ê²Œì„ ìƒì„¸ ì •ë³´ ë¡œë“œ ì‹¤íŒ¨: ' + error.message);
            }
        }

        // ê²Œì„ ìƒì„¸ ì •ë³´ í‘œì‹œ
        function displayGameDetails(game) {
            const container = document.getElementById('gameDetail');
            container.innerHTML = `
                <div class="info-grid">
                    <div class="info-item">
                        <strong>ê²Œì„ ì œëª©</strong>
                        ${game.title}
                    </div>
                    <div class="info-item">
                        <strong>ê²Œì„ ID</strong>
                        ${game.id}
                    </div>
                    <div class="info-item">
                        <strong>ìƒíƒœ</strong>
                        <span class="status ${game.status.toLowerCase()}">${game.status}</span>
                    </div>
                    <div class="info-item">
                        <strong>ì°¸ê°€ì</strong>
                        ${game.currentPlayers || 0}/${game.maxPlayers || 'N/A'}ëª…
                    </div>
                    <div class="info-item">
                        <strong>í˜„ì¬ ë¼ìš´ë“œ</strong>
                        ${game.currentRound || 0}/${game.totalRounds || 'N/A'}
                    </div>
                    <div class="info-item">
                        <strong>ê²Œì„ ì‹œê°„</strong>
                        ${game.gameDuration || 'N/A'}ì´ˆ
                    </div>
                    <div class="info-item">
                        <strong>í˜¸ìŠ¤íŠ¸</strong>
                        ${game.hostUserId ? (game.hostUserId === (currentUser ? currentUser.id : null) ? 'ë‚˜' : game.hostUserId) : 'N/A'}
                    </div>
                </div>
            `;
            
            // í˜¸ìŠ¤íŠ¸ ê¶Œí•œ í™•ì¸ ë° ì»¨íŠ¸ë¡¤ í‘œì‹œ
            checkHostPermissions(game);
        }

        // í˜¸ìŠ¤íŠ¸ ê¶Œí•œ í™•ì¸
        function checkHostPermissions(game) {
    console.log('checkHostPermissions í•¨ìˆ˜ ì‹¤í–‰ë¨');
    console.log('ê²Œì„ ìƒíƒœ:', game.status);
    
    const hostControls = document.getElementById('hostControls');
    const startBtn = document.getElementById('startGameBtn');
    const pauseBtn = document.getElementById('pauseGameBtn');
    const endBtn = document.getElementById('endGameBtn');
    
    console.log('ë²„íŠ¼ ìš”ì†Œë“¤:', { startBtn, pauseBtn, endBtn });
    
    const isHost = game.hostUserId === (currentUser ? currentUser.id : null);
    
    if (isHost) {
        hostControls.classList.remove('hidden');
        console.log('í˜¸ìŠ¤íŠ¸ ê¶Œí•œ í™•ì¸ë¨, ê²Œì„ ìƒíƒœ ì²´í¬ ì‹œì‘');
        
        const gameStatus = game.status.toUpperCase();
        // ê²Œì„ ìƒíƒœì— ë”°ë¼ ë²„íŠ¼ í‘œì‹œ/ìˆ¨ê¹€
        if (gameStatus === 'WAITING') {
            console.log('WAITING ìƒíƒœ ì²˜ë¦¬');
            startBtn.style.display = 'inline-block';
            pauseBtn.style.display = 'none';
            endBtn.style.display = 'none';
        } else if (game.status === 'PLAYING') {
            console.log('PLAYING ìƒíƒœ ì²˜ë¦¬');
            startBtn.style.display = 'none';
            pauseBtn.style.display = 'inline-block';
            endBtn.style.display = 'inline-block';
        } else if (game.status === 'PAUSED') {
            console.log('PAUSED ìƒíƒœ ì²˜ë¦¬');
            startBtn.style.display = 'inline-block';
            startBtn.textContent = 'ê²Œì„ ì¬ê°œ';
            pauseBtn.style.display = 'none';
            endBtn.style.display = 'inline-block';
        } else {
            console.log('ê¸°íƒ€ ìƒíƒœ(' + game.status + ') ì²˜ë¦¬ - ëª¨ë“  ë²„íŠ¼ ìˆ¨ê¹€');
            startBtn.style.display = 'none';
            pauseBtn.style.display = 'none';
            endBtn.style.display = 'none';
        }
        
        console.log('ìµœì¢… ë²„íŠ¼ display ìƒíƒœ:');
        console.log('startBtn:', startBtn.style.display);
        console.log('pauseBtn:', pauseBtn.style.display);
        console.log('endBtn:', endBtn.style.display);
    } else {
        hostControls.classList.add('hidden');
    }
}

        // ê²Œì„ ì‹œì‘
        async function startGame() {
            if (!checkAuth() || !selectedGame) {
                showError('ê²Œì„ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }

            try {

                if (currentPlayer && !currentPlayer.isReady) {
                    const readyResponse = await fetch(`${API_BASE}/games/${selectedGame.id}/ready`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${currentToken}`
                        },
                        body: JSON.stringify({ isReady: true })
                    });

                    if (!readyResponse.ok) {
                        const readyData = await readyResponse.json();
                        showError('í˜¸ìŠ¤íŠ¸ ì¤€ë¹„ ìƒíƒœ ì„¤ì • ì‹¤íŒ¨: ' + (readyData.error || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'));
                        return;
                    }
                }

                const response = await fetch(`${API_BASE}/games/${selectedGame.id}/start`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${currentToken}`
                    }
                });

                const data = await response.json();
                showResponse('ê²Œì„ ì‹œì‘', data);
                
                if (data.success) {
                    showSuccess('ê²Œì„ì´ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤! ê²Œì„ í™”ë©´ìœ¼ë¡œ ì´ë™í•©ë‹ˆë‹¤.');
                    setTimeout(() => {
                        window.open(`game-play.html?gameId=${selectedGame.id}`, '_blank');
                    }, 2000);
                    await loadGameDetails(selectedGame.id);
                } else {
                    showError('ê²Œì„ ì‹œì‘ ì‹¤íŒ¨: ' + (data.error || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'));
                }
            } catch (error) {
                showError('ê²Œì„ ì‹œì‘ ìš”ì²­ ì‹¤íŒ¨: ' + error.message);
            }
        }

        // ê²Œì„ ì¼ì‹œì •ì§€
        async function pauseGame() {
            if (!checkAuth() || !selectedGame) {
                showError('ê²Œì„ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/games/${selectedGame.id}/pause`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${currentToken}`
                    }
                });

                const data = await response.json();
                showResponse('ê²Œì„ ì¼ì‹œì •ì§€', data);
                
                if (data.success) {
                    showSuccess('ê²Œì„ì´ ì¼ì‹œì •ì§€ë˜ì—ˆìŠµë‹ˆë‹¤.');
                    await loadGameDetails(selectedGame.id);
                } else {
                    showError('ê²Œì„ ì¼ì‹œì •ì§€ ì‹¤íŒ¨: ' + (data.error || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'));
                }
            } catch (error) {
                showError('ê²Œì„ ì¼ì‹œì •ì§€ ìš”ì²­ ì‹¤íŒ¨: ' + error.message);
            }
        }

        // ê²Œì„ ì¢…ë£Œ
        async function endGame() {
            if (!checkAuth() || !selectedGame) {
                showError('ê²Œì„ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }

            if (!confirm('ì •ë§ë¡œ ê²Œì„ì„ ì¢…ë£Œí•˜ì‹œê² ìŠµë‹ˆê¹Œ? ì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.')) {
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/games/${selectedGame.id}/end`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${currentToken}`
                    }
                });

                const data = await response.json();
                showResponse('ê²Œì„ ì¢…ë£Œ', data);
                
                if (data.success) {
                    showSuccess('ê²Œì„ì´ ì¢…ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.');
                    await loadGameDetails(selectedGame.id);
                } else {
                    showError('ê²Œì„ ì¢…ë£Œ ì‹¤íŒ¨: ' + (data.error || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'));
                }
            } catch (error) {
                showError('ê²Œì„ ì¢…ë£Œ ìš”ì²­ ì‹¤íŒ¨: ' + error.message);
            }
        }

        // í”Œë ˆì´ì–´ ì •ë³´ í‘œì‹œ
        function displayPlayers(players) {
            if (!players || players.length === 0) {
                document.getElementById('myPlayerInfo').innerHTML = '<div class="loading">í”Œë ˆì´ì–´ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</div>';
                document.getElementById('otherPlayersList').innerHTML = '<div class="loading">ë‹¤ë¥¸ í”Œë ˆì´ì–´ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
                return;
            }

            // í˜„ì¬ ì‚¬ìš©ìì˜ í”Œë ˆì´ì–´ ì°¾ê¸°
            const myPlayer = players.find(p => p.userId === (currentUser ? currentUser.id : null));
            currentPlayer = myPlayer;
            updateUserStatus();

            // ë‚´ í”Œë ˆì´ì–´ ì •ë³´ í‘œì‹œ
            if (myPlayer) {
                const myPlayerContainer = document.getElementById('myPlayerInfo');
                myPlayerContainer.innerHTML = `
                    <div class="info-item">
                        <strong>ë‹‰ë„¤ì„</strong>
                        ${myPlayer.nickname}
                    </div>
                    <div class="info-item">
                        <strong>í”Œë ˆì´ì–´ ID</strong>
                        ${myPlayer.id}
                    </div>
                    <div class="info-item">
                        <strong>í˜„ì¬ í˜„ê¸ˆ</strong>
                        ${(myPlayer.currentCash || 0).toLocaleString()}ì›
                    </div>
                    <div class="info-item">
                        <strong>ì´ ìì‚° ê°€ì¹˜</strong>
                        ${(myPlayer.totalAssetValue || 0).toLocaleString()}ì›
                    </div>
                    <div class="info-item">
                        <strong>ì†ìµ</strong>
                        <span class="price-change ${(myPlayer.profitLoss || 0) >= 0 ? 'positive' : 'negative'}">
                            ${(myPlayer.profitLoss || 0).toLocaleString()}ì›
                        </span>
                    </div>
                    <div class="info-item">
                        <strong>ìˆ˜ìµë¥ </strong>
                        <span class="price-change ${(myPlayer.profitRate || 0) >= 0 ? 'positive' : 'negative'}">
                            ${(myPlayer.profitRate || 0).toFixed(2)}%
                        </span>
                    </div>
                    <div class="info-item">
                        <strong>í˜„ì¬ ìˆœìœ„</strong>
                        ${myPlayer.ranking || '-'}ìœ„
                    </div>
                `;
            } else {
                document.getElementById('myPlayerInfo').innerHTML = '<div class="loading">ë‚´ í”Œë ˆì´ì–´ ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</div>';
            }

            // ë‹¤ë¥¸ í”Œë ˆì´ì–´ë“¤ í‘œì‹œ
            const otherPlayers = players.filter(p => p.id !== (myPlayer ? myPlayer.id : null));
            const otherPlayersContainer = document.getElementById('otherPlayersList');
            
            if (otherPlayers.length === 0) {
                otherPlayersContainer.innerHTML = '<div class="loading">ë‹¤ë¥¸ í”Œë ˆì´ì–´ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
                return;
            }

            otherPlayersContainer.innerHTML = '';
            otherPlayers.forEach(player => {
                const playerCard = document.createElement('div');
                playerCard.className = 'player-card';
                playerCard.innerHTML = `
                    <h4>${player.nickname}</h4>
                    <p><strong>í”Œë ˆì´ì–´ ID:</strong> ${player.id}</p>
                    <p><strong>í˜„ì¬ í˜„ê¸ˆ:</strong> ${(player.currentCash || 0).toLocaleString()}ì›</p>
                    <p><strong>ì´ ìì‚°:</strong> ${(player.totalAssetValue || 0).toLocaleString()}ì›</p>
                    <p><strong>ìˆ˜ìµë¥ :</strong> 
                        <span class="price-change ${(player.profitRate || 0) >= 0 ? 'positive' : 'negative'}">
                            ${(player.profitRate || 0).toFixed(2)}%
                        </span>
                    </p>
                    <p><strong>ìˆœìœ„:</strong> ${player.ranking || '-'}ìœ„</p>
                `;
                otherPlayersContainer.appendChild(playerCard);
            });
        }

        // ì£¼ì‹ ì¢…ëª© í‘œì‹œ
        function displayStocks(stocks) {
            const container = document.getElementById('stocksList');
            
            if (!stocks || stocks.length === 0) {
                container.innerHTML = '<div class="loading">ì¢…ëª© ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
                return;
            }

            container.innerHTML = '';
            stocks.forEach(stock => {
                const currentPrice = Number(stock.currentPrice) || 0;
                const initialPrice = Number(stock.initialPrice) || 1;
                const changePercent = ((currentPrice - initialPrice) / initialPrice * 100).toFixed(2);
                
                const stockCard = document.createElement('div');
                stockCard.className = 'stock-card';
                stockCard.innerHTML = `
                    <h4>${stock.stockTemplate?.name || stock.stockCode}</h4>
                    <p><strong>ì¢…ëª© ì½”ë“œ:</strong> ${stock.stockCode}</p>
                    <p><strong>ID:</strong> ${stock.id}</p>
                    <p><strong>ì„¹í„°:</strong> ${stock.stockTemplate?.sector || 'N/A'}</p>
                    <p><strong>í˜„ì¬ê°€:</strong> ${currentPrice.toLocaleString()}ì›</p>
                    <p><strong>ì´ˆê¸°ê°€:</strong> ${initialPrice.toLocaleString()}ì›</p>
                    <p><strong>ë³€ë™ë¥ :</strong> 
                        <span class="price-change ${changePercent >= 0 ? 'positive' : 'negative'}">
                            ${changePercent}%
                        </span>
                    </p>
                    <p><strong>ë³€ë™ì„±:</strong> ${((stock.volatility || 0) * 100).toFixed(1)}%</p>
                    <button class="btn btn-success" onclick="setTradeStock('${stock.stockCode}')">ê±°ë˜í•˜ê¸°</button>
                `;
                container.appendChild(stockCard);
            });
        }

        // ê±°ë˜í•  ì¢…ëª© ì„¤ì •
        function setTradeStock(stockCode) {
            document.getElementById('tradeStockCode').value = stockCode;
            document.getElementById('tradeStockCode').focus();
        }

        // ì£¼ì‹ ê±°ë˜ ì‹¤í–‰
        async function executeTrade() {
            if (!checkAuth() || !selectedGame || !currentPlayer) {
                showError('ë¡œê·¸ì¸í•˜ê³  ê²Œì„ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }
            
            const stockCode = document.getElementById('tradeStockCode').value;
            const type = document.getElementById('tradeType').value;
            const quantity = parseInt(document.getElementById('tradeQuantity').value);
            
            if (!stockCode || !quantity) {
                showError('ì¢…ëª© ì½”ë“œì™€ ìˆ˜ëŸ‰ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/games/${selectedGame.id}/trades`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${currentToken}`
                    },
                    body: JSON.stringify({ 
                        playerId: currentPlayer.id, 
                        stockCode, 
                        type, 
                        quantity 
                    })
                });

                const data = await response.json();
                showResponse('ê±°ë˜ ì‹¤í–‰', data);
                
                if (data.success) {
                    showSuccess(`${type === 'BUY' ? 'ë§¤ìˆ˜' : 'ë§¤ë„'} ê±°ë˜ê°€ ì²´ê²°ë˜ì—ˆìŠµë‹ˆë‹¤!`);
                    // í¼ ì´ˆê¸°í™”
                    document.getElementById('tradeStockCode').value = '';
                    document.getElementById('tradeQuantity').value = '';
                    
                    // ê²Œì„ ìƒì„¸ ì •ë³´ ìƒˆë¡œê³ ì¹¨
                    await loadGameDetails(selectedGame.id);
                } else {
                    showError('ê±°ë˜ ì‹¤íŒ¨: ' + (data.error || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'));
                }
            } catch (error) {
                showError('ê±°ë˜ ìš”ì²­ ì‹¤íŒ¨: ' + error.message);
            }
        }

        // ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ë“¤
        function showResponse(action, data) {
            const responseDiv = document.getElementById('apiResponse');
            responseDiv.textContent = `[${new Date().toLocaleTimeString()}] ${action}:\n${JSON.stringify(data, null, 2)}`;
        }

        function showError(message) {
            const existingError = document.querySelector('.error');
            if (existingError) existingError.remove();
            
            const errorDiv = document.createElement('div');
            errorDiv.className = 'error';
            errorDiv.textContent = message;
            
            // í˜„ì¬ í™œì„± íƒ­ì— ë©”ì‹œì§€ í‘œì‹œ
            const activeTab = document.querySelector('.tab-content.active');
            activeTab.insertBefore(errorDiv, activeTab.firstChild);
            
            setTimeout(() => errorDiv.remove(), 5000);
        }

        function showSuccess(message) {
            const existingSuccess = document.querySelector('.success');
            if (existingSuccess) existingSuccess.remove();
            
            const successDiv = document.createElement('div');
            successDiv.className = 'success';
            successDiv.textContent = message;
            
            // í˜„ì¬ í™œì„± íƒ­ì— ë©”ì‹œì§€ í‘œì‹œ
            const activeTab = document.querySelector('.tab-content.active');
            activeTab.insertBefore(successDiv, activeTab.firstChild);
            
            setTimeout(() => successDiv.remove(), 3000);
        }

        function showWarning(message) {
            const existingWarning = document.querySelector('.warning');
            if (existingWarning) existingWarning.remove();
            
            const warningDiv = document.createElement('div');
            warningDiv.className = 'warning';
            warningDiv.textContent = message;
            
            // í˜„ì¬ í™œì„± íƒ­ì— ë©”ì‹œì§€ í‘œì‹œ
            const activeTab = document.querySelector('.tab-content.active');
            activeTab.insertBefore(warningDiv, activeTab.firstChild);
            
            setTimeout(() => warningDiv.remove(), 4000);
        }

        // í‚¤ë³´ë“œ ë‹¨ì¶•í‚¤
        document.addEventListener('keydown', function(e) {
            if (e.ctrlKey) {
                switch(e.key) {
                    case '1':
                        e.preventDefault();
                        showTab('auth');
                        break;
                    case '2':
                        e.preventDefault();
                        showTab('game');
                        break;
                    case 'r':
                        e.preventDefault();
                        if (selectedGame) {
                            loadGameDetails(selectedGame.id);
                        }
                        break;
                    case 'm':
                        e.preventDefault();
                        if (currentToken) {
                            loadMyGames();
                        }
                        break;
                }
            }
        });

        // ìë™ ìƒˆë¡œê³ ì¹¨ (ì„ íƒì )
        function startAutoRefresh() {
            setInterval(() => {
                if (selectedGame && currentToken && document.getElementById('game-tab').classList.contains('active')) {
                    loadGameDetails(selectedGame.id);
                }
            }, 15000); // 15ì´ˆë§ˆë‹¤ ìë™ ìƒˆë¡œê³ ì¹¨
        }

        // í•„ìš”ì‹œ ìë™ ìƒˆë¡œê³ ì¹¨ ì‹œì‘
        // startAutoRefresh();
    </script>
</body>
</html>